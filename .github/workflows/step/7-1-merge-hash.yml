name: 7-1-合并Hash结果

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  merge-hash:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: 下载 hash_total.json 从 artifact
        uses: actions/download-artifact@v4
        with:
          name: hash-total-json
          path: output/hash/

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Run merge hash script
        run: |
          python scripts/7.1_merge_hash.py

      - name: 上传新的 hash_total.json 到 artifact
        uses: actions/upload-artifact@v4
        with:
          name: hash-total-json
          path: output/hash/hash_total.json

      # 如果你还需要提交其他小文件，可以放这里（可选）
      #- name: Commit and push other files
      #  env:
      #    PUSH_TOKEN: ${{ secrets.PUSH_TOKEN1 }}
      #  run: |
      #    git config user.name "github-actions[bot]"
      #    git config user.email "github-actions[bot]@users.noreply.github.com"
      #
      #    git add path/to/other/files
      #
      #    if git diff --cached --quiet; then
      #      echo "No changes to commit."
      #      exit 0
      #    fi
      #
      #    git commit -m "Update other files [skip ci]"
      #
      #    git remote set-url origin https://x-access-token:${PUSH_TOKEN}@github.com/niuinyang/niuin-s-iptv.git
      #
      #    git pull --rebase origin main
      #    git push origin HEAD:main